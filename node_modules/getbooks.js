var request = require('request');

var getBooks = function(listName, callback){
	var token = '419795ff776761203908204af05030fd:3:68519486',
		url = 'http://api.nytimes.com/svc/books/v2/lists//' + listName + '.json?&offset=&sortby=&sortorder=&api-key=',
		fullUrl = url + token,
		books = [];
			
	request(fullUrl, function(error, response, body){
		if(!error && response.statusCode == 200){
			var data = JSON.parse(body);
			for (var i = 0; i < data.results.length; i++) {
				books.push({
					title: data.results[i].book_details[0].title,
					author: data.results[i].book_details[0].author,
					snippet: data.results[i].book_details[0].description,
					rank: data.results[i].rank,
					image:data.results[i].book_details[0].book_image,
					weeks_on_list: data.results[i].weeks_on_list,
					isbn10: data.results[i].book_details[0].primary_isbn10,
					isbn13: data.results[i].book_details[0].primary_isbn13,
				});
			};
			//console.log(books);
			callback(null, books);
		}else{
			callback(new Error('An error ocurred, most likely with the http request'));
		}
	});
}

exports.getBooks = getBooks;